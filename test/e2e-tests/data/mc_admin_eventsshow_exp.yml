# Copyright 2022 MobiledgeX, Inc
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

- search:
    match:
      types:
      - event
    notmatch:
      names:
      - cluster-svc create AppInst
    limit: 5
  results:
  - name: Free ClusterInst reservation
    org:
    - AcmeAppCo
    type: event
    region: local
    mtags:
      app: autoprovHA
      appinst: autoprov-autoprovha10
      appinstorg: AcmeAppCo
      apporg: AcmeAppCo
      appver: "1.0"
      cloudlet: gcp-cloud-5
      cloudletfedorg: ""
      cloudletorg: gcp
      cluster: Reservable4
      clusterorg: edgecloudorg
      hostname: ""
      lineno: ""
      spanid: ""
      traceid: ""
  - name: Free ClusterInst reservation
    org:
    - AcmeAppCo
    type: event
    region: local
    mtags:
      app: autoprovHA
      appinst: autoprov-autoprovha10
      appinstorg: AcmeAppCo
      apporg: AcmeAppCo
      appver: "1.0"
      cloudlet: dmuus-cloud-1
      cloudletfedorg: ""
      cloudletorg: dmuus
      cluster: Reservable1
      clusterorg: edgecloudorg
      hostname: ""
      lineno: ""
      spanid: ""
      traceid: ""
  - name: Free ClusterInst reservation
    org:
    - AcmeAppCo
    type: event
    region: local
    mtags:
      app: autoprovHA
      appinst: autoprov-autoprovha10
      appinstorg: AcmeAppCo
      apporg: AcmeAppCo
      appver: "1.0"
      cloudlet: azure-cloud-4
      cloudletfedorg: ""
      cloudletorg: azure
      cluster: Reservable3
      clusterorg: edgecloudorg
      hostname: ""
      lineno: ""
      spanid: ""
      traceid: ""
  - name: Cloudlet maintenance done
    org:
    - dmuus
    type: event
    region: local
    mtags:
      cloudlet: dmuus-cloud-1
      cloudletfedorg: ""
      cloudletorg: dmuus
      hostname: ""
      lineno: ""
      maintenance-state: NORMAL_OPERATION
      spanid: ""
      traceid: ""
  - name: Reserve ClusterInst
    org:
    - AcmeAppCo
    type: event
    region: local
    mtags:
      app: autoprovHA
      appinst: autoprov-autoprovha10
      appinstorg: AcmeAppCo
      apporg: AcmeAppCo
      appver: "1.0"
      cloudlet: gcp-cloud-5
      cloudletfedorg: ""
      cloudletorg: gcp
      cluster: Reservable4
      clusterorg: edgecloudorg
      hostname: ""
      lineno: ""
      spanid: ""
      traceid: ""
- search:
    match:
      types:
      - audit
    notmatch:
      names:
      - ShowEvents
      - EventTerms
    limit: 5
  results:
  - name: DeleteAutoProvPolicy
    org:
    - AcmeAppCo
    type: audit
    mtags:
      duration: ""
      email: user2@email.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/DeleteAutoProvPolicy
      method: POST
      org: AcmeAppCo
      policy: autoprovHA
      policyorg: AcmeAppCo
      region: local
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"405","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"AutoProvPolicy":{"cloudlets":[{"key":{"name":"dmuus-cloud-1","organization":"dmuus"}},{"key":{"name":"dmuus-cloud-2","organization":"dmuus"}},{"key":{"name":"azure-cloud-4","organization":"azure"}},{"key":{"name":"gcp-cloud-5","organization":"gcp"}}],"key":{"name":"autoprovHA","organization":"AcmeAppCo"},"max_instances":4,"min_active_instances":2},"Region":"local"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{}'
      spanid: ""
      status: "200"
      traceid: ""
      username: user2
  - name: DeleteApp
    org:
    - AcmeAppCo
    type: audit
    mtags:
      app: autoprovHA
      apporg: AcmeAppCo
      appver: "1.0"
      duration: ""
      email: user2@email.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/DeleteApp
      method: POST
      org: AcmeAppCo
      region: local
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"381","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"App":{"access_ports":"tcp:82","auto_prov_policies":["autoprovHA"],"default_flavor":{"name":"x1.small"},"deployment":"kubernetes","image_path":"registry.mobiledgex.net/AcmeAppCo/someapplication1:1.0","image_type":"Docker","key":{"name":"autoprovHA","organization":"AcmeAppCo","version":"1.0"}},"Region":"local"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{}'
      spanid: ""
      status: "200"
      traceid: ""
      username: user2
  - name: UpdateCloudlet
    org:
    - dmuus
    type: audit
    mtags:
      cloudlet: dmuus-cloud-1
      cloudletfedorg: ""
      cloudletorg: dmuus
      duration: ""
      email: user1@email.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/UpdateCloudlet
      method: POST
      org: dmuus
      region: local
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"123","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"Cloudlet":{"key":{"name":"dmuus-cloud-1","organization":"dmuus"}},"Region":"local"}'
      respheaders: '{"Content-Type":"application/json"}'
      response: |
        {"data":{"message":"Cloudlet is back to normal operation"}}
      spanid: ""
      status: "200"
      traceid: ""
      username: user1
  - name: RemoveAutoProvPolicyCloudlet
    org:
    - AcmeAppCo
    type: audit
    mtags:
      duration: ""
      email: user2@email.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/RemoveAutoProvPolicyCloudlet
      method: POST
      org: AcmeAppCo
      policy: autoprovHA
      policyorg: AcmeAppCo
      region: local
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"163","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"AutoProvPolicyCloudlet":{"cloudlet_key":{"name":"dmuus-cloud-2","organization":"dmuus"},"key":{"name":"autoprovHA","organization":"AcmeAppCo"}},"Region":"local"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{}'
      spanid: ""
      status: "200"
      traceid: ""
      username: user2
  - name: UpdateCloudlet
    org:
    - dmuus
    type: audit
    mtags:
      cloudlet: dmuus-cloud-1
      cloudletfedorg: ""
      cloudletorg: dmuus
      duration: ""
      email: user1@email.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/UpdateCloudlet
      method: POST
      org: dmuus
      region: local
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"124","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"Cloudlet":{"key":{"name":"dmuus-cloud-1","organization":"dmuus"},"maintenance_state":"MaintenanceStart"},"Region":"local"}'
      respheaders: '{"Content-Type":"application/json"}'
      response: |
        {"data":{"message":"Starting AutoProv failover"}}
        {"data":{"message":"Created AppInst {\"name\":\"autoprov-autoprovha10\",\"organization\":\"AcmeAppCo\",\"cloudlet_key\":{\"organization\":\"azure\",\"name\":\"azure-cloud-4\"}} to meet policy autoprovHA min constraint 2"}}
        {"data":{"message":"AutoProv failover completed"}}
        {"data":{"message":"Starting CRM maintenance"}}
        {"data":{"message":"CRM maintenance started"}}
        {"data":{"message":"Cloudlet is in maintenance"}}
      spanid: ""
      status: "200"
      traceid: ""
      username: user1
- search:
    match:
      failed: true
    limit: 3
  results:
  - name: DeleteOrg
    org:
    - platos
    type: audit
    mtags:
      duration: ""
      email: mexadmin-email-not-specified
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/org/delete
      method: POST
      org: platos
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"97","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"Name":"platos"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{"message":"Organization platos in use or check failed: region local:
        in use by some App; region locala: in use by some App"}'
      spanid: ""
      status: "400"
      traceid: ""
      username: mexadmin
  - name: DeleteOrg
    org:
    - gcp
    type: audit
    mtags:
      duration: ""
      email: mexadmin-email-not-specified
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/org/delete
      method: POST
      org: gcp
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"94","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"Name":"gcp"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{"message":"Organization gcp in use or check failed: region local:
        in use by some AppInst, Cloudlet, ClusterInst"}'
      spanid: ""
      status: "400"
      traceid: ""
      username: mexadmin
  - name: DeleteOrg
    org:
    - azure
    type: audit
    mtags:
      duration: ""
      email: mexadmin-email-not-specified
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/org/delete
      method: POST
      org: azure
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"96","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"Name":"azure"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{"message":"Organization azure in use or check failed: region local:
        in use by some AppInst, Cloudlet, ClusterInst"}'
      spanid: ""
      status: "400"
      traceid: ""
      username: mexadmin
- search:
    match:
      orgs:
      - AcmeAppCo
    limit: 3
  results:
  - name: DeleteAutoProvPolicy
    org:
    - AcmeAppCo
    type: audit
    mtags:
      duration: ""
      email: user2@email.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/DeleteAutoProvPolicy
      method: POST
      org: AcmeAppCo
      policy: autoprovHA
      policyorg: AcmeAppCo
      region: local
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"405","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"AutoProvPolicy":{"cloudlets":[{"key":{"name":"dmuus-cloud-1","organization":"dmuus"}},{"key":{"name":"dmuus-cloud-2","organization":"dmuus"}},{"key":{"name":"azure-cloud-4","organization":"azure"}},{"key":{"name":"gcp-cloud-5","organization":"gcp"}}],"key":{"name":"autoprovHA","organization":"AcmeAppCo"},"max_instances":4,"min_active_instances":2},"Region":"local"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{}'
      spanid: ""
      status: "200"
      traceid: ""
      username: user2
  - name: Free ClusterInst reservation
    org:
    - AcmeAppCo
    type: event
    region: local
    mtags:
      app: autoprovHA
      appinst: autoprov-autoprovha10
      appinstorg: AcmeAppCo
      apporg: AcmeAppCo
      appver: "1.0"
      cloudlet: gcp-cloud-5
      cloudletfedorg: ""
      cloudletorg: gcp
      cluster: Reservable4
      clusterorg: edgecloudorg
      hostname: ""
      lineno: ""
      spanid: ""
      traceid: ""
  - name: Free ClusterInst reservation
    org:
    - AcmeAppCo
    type: event
    region: local
    mtags:
      app: autoprovHA
      appinst: autoprov-autoprovha10
      appinstorg: AcmeAppCo
      apporg: AcmeAppCo
      appver: "1.0"
      cloudlet: dmuus-cloud-1
      cloudletfedorg: ""
      cloudletorg: dmuus
      cluster: Reservable1
      clusterorg: edgecloudorg
      hostname: ""
      lineno: ""
      spanid: ""
      traceid: ""
- search:
    match:
      tags:
        app: someapplication1
    limit: 3
  results:
  - name: CreateApp
    org:
    - AcmeAppCo
    type: audit
    mtags:
      app: someapplication1
      apporg: AcmeAppCo
      appver: "1.0"
      duration: ""
      email: user2@email.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/CreateApp
      method: POST
      org: AcmeAppCo
      region: locala
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"902","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"App":{"access_ports":"tcp:80,tcp:443,udp:10002","android_package_name":"com.acme.someapplication1","auth_public_key":"-----BEGIN
        PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0Spdynjh+MPcziCH2Gij\nTkK9fspTH4onMtPTgxo+MQC+OZTwetvYFJjGV8jnYebtuvWWUCctYmt0SIPmA0F0\nVU6qzSlrBOKZ9yA7Rj3jSQtNrI5vfBIzK1wPDm7zuy5hytzauFupyfboXf4qS4uC\nGJCm9EOzUSCLRryyh7kTxa4cYHhhTTKNTTy06lc7YyxBsRsN/4jgxjjkxe3J0SfS\nz3eaHmfFn/GNwIAqy1dddTJSPugRkK7ZjFR+9+sscY9u1+F5QPwxa8vTB0U6hh1m\nQnhVd1d9osRwbyALfBY8R+gMgGgEBCPYpL3u5iSjgD6+n4d9RQS5zYRpeMJ1fX0C\n/QIDAQAB\n-----END
        PUBLIC KEY-----\n","default_flavor":{"name":"x1.small"},"deployment":"kubernetes","image_path":"registry.mobiledgex.net/AcmeAppCo/someapplication1:1.0","image_type":"Docker","key":{"name":"someapplication1","organization":"AcmeAppCo","version":"1.0"}},"Region":"locala"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{}'
      spanid: ""
      status: "200"
      traceid: ""
      username: user2
  - name: Reserve ClusterInst
    org:
    - AcmeAppCo
    type: event
    region: local
    mtags:
      app: someapplication1
      appinst: someapplication12
      appinstorg: AcmeAppCo
      apporg: AcmeAppCo
      appver: "1.0"
      cloudlet: dmuus-cloud-2
      cloudletfedorg: ""
      cloudletorg: dmuus
      cluster: reservable0
      clusterorg: edgecloudorg
      hostname: ""
      lineno: ""
      spanid: ""
      traceid: ""
  - name: AutoCluster create
    org:
    - AcmeAppCo
    type: event
    region: local
    mtags:
      app: someapplication1
      appinst: someapplication12
      appinstorg: AcmeAppCo
      apporg: AcmeAppCo
      appver: "1.0"
      cloudlet: dmuus-cloud-2
      cloudletfedorg: ""
      cloudletorg: dmuus
      cluster: reservable0
      clusterorg: edgecloudorg
      duration: ""
      hostname: ""
      lineno: ""
      spanid: ""
      traceid: ""
- search:
    match:
      names:
      - CreateApp
    limit: 3
  results:
  - name: CreateApp
    org:
    - AcmeAppCo
    type: audit
    mtags:
      app: autoprovHA
      apporg: AcmeAppCo
      appver: "1.0"
      duration: ""
      email: user2@email.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/CreateApp
      method: POST
      org: AcmeAppCo
      region: local
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"381","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"App":{"access_ports":"tcp:82","auto_prov_policies":["autoprovHA"],"default_flavor":{"name":"x1.small"},"deployment":"kubernetes","image_path":"registry.mobiledgex.net/AcmeAppCo/someapplication1:1.0","image_type":"Docker","key":{"name":"autoprovHA","organization":"AcmeAppCo","version":"1.0"}},"Region":"local"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{}'
      spanid: ""
      status: "200"
      traceid: ""
      username: user2
  - name: CreateApp
    org:
    - user3org
    type: audit
    mtags:
      app: ep1
      apporg: user3org
      appver: "1.0"
      duration: ""
      email: user3@enterprise.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/CreateApp
      method: POST
      org: user3org
      region: local
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"341","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"App":{"access_ports":"tcp:80,tcp:443,udp:10002","default_flavor":{"name":"x1.small"},"deployment":"kubernetes","image_path":"registry.mobiledgex.net/user3org/ep1:1.0","image_type":"Docker","key":{"name":"ep1","organization":"user3org","version":"1.0"}},"Region":"local"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{}'
      spanid: ""
      status: "200"
      traceid: ""
      username: user3
  - name: CreateApp
    org:
    - platos
    type: audit
    mtags:
      app: platosEnablingLayer
      apporg: platos
      appver: "1.0"
      duration: ""
      email: user2@email.com
      hostname: ""
      lineno: ""
      localuri: /api/v1/auth/ctrl/CreateApp
      method: POST
      org: platos
      region: locala
      remote-ip: 127.0.0.1
      reqheaders: '{"Accept":"application/json","Accept-Encoding":"gzip","Authorization":"****","Connection":"close","Content-Length":"342","Content-Type":"application/json","User-Agent":"Go-http-client/1.1","X-Api-Key":"****"}'
      request: '{"App":{"access_ports":"tcp:64000","default_flavor":{"name":"x1.small"},"deployment":"kubernetes","image_path":"registry.mobiledgex.net/platos/dummyvalue","image_type":"Docker","key":{"name":"platosEnablingLayer","organization":"platos","version":"1.0"}},"Region":"locala"}'
      respheaders: '{"Content-Type":"application/json; charset=UTF-8"}'
      response: '{}'
      spanid: ""
      status: "200"
      traceid: ""
      username: user2
